# main.yml

variables:
  valeur: 5

stages:
  - stage: Stage1
    jobs:
      - job: Job1
        steps:
          - task: powershell@2
            inputs:
              filePath: Tests/LoadData.ps1

          - script: echo $(foo)
            displayName: read foo

          - bash: echo "##vso[task.setvariable variable=bar;isOutput=true]$(foo)"
            name: step1
            displayName: create public variable

  - stage: Stage2
    variables:
      foo2b: $[ stageDependencies.Stage1.Job1.outputs['step1.bar'] ]
    jobs:
      - job:
        steps:
          - script: echo $(foo2)
            displayName: read foo2

  - stage: Stage2bis
    jobs:
      - job:
        steps:
          - script: echo $[ stageDependencies.Stage2.outputs['foo2b'] ]

  # - template: myTemplate.yml
  #   parameters:
  #     # foo3: $[ stageDependencies.Stage1.Job1.outputs['step1.bar'] ]
  #     foo3: "##vso[task.setvariable variable=bar;isOutput=true]$[ stageDependencies.Stage1.Job1.outputs['step1.bar'] ]"
  #     foo4: $(valeur)
